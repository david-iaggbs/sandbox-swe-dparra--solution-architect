# sandbox-swe-dparra--solution-architect

Central solution architect workspace for the `david-iaggbs` organization. This repository serves as:

- **Product registry** — catalog of all products and their repositories
- **Initiative intake** — entry point for analyzing new business initiatives
- **Design hub** — architectural decisions and decomposition plans before any code is written

## How It Works

This repository operates at two levels:

**Initiatives** (GitHub Projects) and **Epics** (GitHub Issues labeled `epic`) both originate in the [`sandbox-swe-dparra--product-owner`](https://github.com/david-iaggbs/sandbox-swe-dparra--product-owner) repository, where business stakeholders submit requirements using the standard intake form and Claude generates structured initiatives and epics from them.

Once an epic reaches this repository — either directly or via cross-repo reference — Claude evaluates it against the product registry and active initiatives, and produces an architectural impact analysis.

---

## Product Registry

Each product groups related repositories under a shared domain. Naming convention:

| Repo type | Pattern | Purpose |
|-----------|---------|---------|
| Infrastructure | `sandbox-swe-dparra--{product}--infra` | Shared VPC, ECS Cluster, ALB, EventBridge bus |
| Design | `sandbox-swe-dparra--{product}--design` | Architecture plans, ADRs, API contracts |
| Service | `sandbox-swe-dparra--{product}--{service}--service` | Spring Boot microservice |
| Web UI | `sandbox-swe-dparra--{product}--{ui}--ui` | Astro SSR web UI |

### Registered Products

| Product | Domain | Infra | Design | Services | UIs |
|---------|--------|-------|--------|----------|-----|
| `booking` | Online booking and availability management | [infra](https://github.com/david-iaggbs/sandbox-swe-dparra--booking--infra) | [design](https://github.com/david-iaggbs/sandbox-swe-dparra--booking--design) | [availability-service](https://github.com/david-iaggbs/sandbox-swe-dparra--booking--availability--service) | — |
| `minesweeper` | Minesweeper game product — engine service, browser UI, shared infra, and architecture documentation | [infra](https://github.com/david-iaggbs/sandbox-swe-dparra--terraform-minesweeper--infra) | [design](https://github.com/david-iaggbs/sandbox-swe-dparra--minesweeper--design) | [engine-service](https://github.com/david-iaggbs/sandbox-swe-dparra--minesweeper--engine--service) | [game-ui](https://github.com/david-iaggbs/sandbox-swe-dparra--minesweeper--game--ui) |

> To register a new product, add a row to this table and create the `--infra` and `--design` repos first.

---

## Initiative Evaluation Process

Initiatives are created in [`sandbox-swe-dparra--product-owner`](https://github.com/david-iaggbs/sandbox-swe-dparra--product-owner) as GitHub Projects, generated by Claude from the requirements intake form. When a new project is created in the `david-iaggbs` organization, the `initiative-intake.yml` workflow fires **automatically** and runs the following evaluation, posting results as an intake issue in this repository:

1. **Domain fit** — Does the functionality belong to the bounded context of an existing product?
   - Yes → proceed with existing product repos
   - No → register a new product in this README and create its `--infra` and `--design` repos

2. **Service fit** — Does the functionality extend an existing service or require a new one?
   - Extends existing → create a feature issue in the `{product}--{service}--service` repo
   - New service → create a design spec issue in `{product}--design`, then scaffold once approved

3. **UI fit** — Does the user interaction belong to an existing UI or require a new one?
   - Extends existing → create a feature issue in the `{product}--{ui}--ui` repo
   - New UI → create a design spec issue in `{product}--design`, then scaffold once approved

4. **Infrastructure impact** — Does the initiative require new shared infrastructure?
   - Yes → create a CDK change issue in the `{product}--infra` repo

### Decision Log

Architectural decisions are tracked as ADRs in [`/adr`](./adr/README.md). See the [ADR index](./adr/README.md#index) for the full history.

---

## Epic Evaluation Process

Epics originate in [`sandbox-swe-dparra--product-owner`](https://github.com/david-iaggbs/sandbox-swe-dparra--product-owner), where they are generated by Claude from a business requirements intake. Once an epic is ready for architectural evaluation, it is referenced or linked here.

### Trigger

The evaluation is **fully automatic**. The `epic-evaluation.yml` workflow fires as soon as the `epic` label is applied to any issue in this repository — no manual action required.

To re-trigger an evaluation on an existing epic (e.g., after the epic scope changes), remove and re-apply the `epic` label.

To ask Claude a one-off question about an epic without triggering a full evaluation, use a comment without the label change — the general `claude.yml` workflow still responds to `@claude` mentions in comments on non-epic issues.

### Evaluation Steps

When an epic issue is opened, Claude performs the following analysis in order:

1. **Initiative mapping** — Which GitHub Project (initiative) does this epic belong to?
   - Match the epic's objective against the scope of each active initiative
   - If it fits an existing initiative → recommend assigning it to that project
   - If no initiative covers it → flag that a new initiative must be created first

2. **Product impact** — Which registered products are touched?
   - Cross-reference the product registry against the epic's affected domains
   - Identify every product whose services, UIs, or infrastructure may change
   - Flag products that need to be created if the epic introduces a new domain

3. **Component issue creation** — For every architectural change identified, Claude creates an issue in the corresponding component repository. No work is tracked as a checklist in this repo — all tasks live in their component repo:

   | Change type | Target repo | Issue created |
   |-------------|-------------|---------------|
   | New service needed | `{product}--design` | Design spec issue: entities, endpoints, events |
   | Existing service extended | `{product}--{service}--service` | Feature issue: new endpoints, event producers/consumers |
   | New UI needed | `{product}--design` | Design spec issue: pages, BFF routes, SSM parameters |
   | Existing UI extended | `{product}--{ui}--ui` | Feature issue: new pages, BFF routes |
   | New event contract | `{product}--design` | Contract issue: event schema, EventBridge rule, SQS queue |
   | Infrastructure change | `{product}--infra` | CDK change issue: new/modified shared resources |

   Each issue is created using the standard template for its component type — see [`templates/issues/`](./templates/issues/README.md). Every issue includes: a description of the change, a reference back to this epic, and the full technical context the component team needs to begin implementation without further clarification.

4. **ADR required?** — Does the epic represent a significant architectural decision?
   - New product boundary → yes, open an ADR issue in this repo and write the ADR in `/adr`
   - New cross-cutting pattern → yes, open an ADR issue in this repo and write the ADR in `/adr`
   - Routine feature within established patterns → no ADR needed

5. **Output** — Claude posts a summary comment on the epic issue containing:
   - **Initiative assignment** — which GitHub Project to add this epic to (or a flag to create one)
   - **Affected products** — list of impacted products with links to their repos
   - **Issues created** — links to every issue opened in component repos
   - **ADR** — link to the ADR issue if one was opened, or "not required"

### Example

```
# Epic issue: "Allow guests to cancel their bookings online"

@claude please evaluate this epic
```

Expected Claude output (as issue comment):

```
## Epic Evaluation

**Initiative:** Booking Self-Service Portal (GitHub Project #3)
→ Assigned to project.

**Affected products:** `booking`

**Issues created:**

| Repo | Issue | Type |
|------|-------|------|
| sandbox-swe-dparra--booking--design | #14 — Cancellation endpoint spec (DELETE /api/v1/reservations/{id}) | Design spec |
| sandbox-swe-dparra--booking--design | #15 — ReservationCancelled event contract | Event contract |
| sandbox-swe-dparra--booking--availability--service | #31 — Add cancellation endpoint and publish ReservationCancelled event | Feature |
| sandbox-swe-dparra--booking--infra | #8 — Add EventBridge rule for ReservationCancelled → notification-queue | CDK change |

**ADR:** Not required — follows established service extension pattern.
```

---

## Available Skills

| Skill | Invocation | Purpose |
|-------|-----------|---------|
| `decompose-usecase` | `/decompose-usecase <use case>` | Analyze a use case → full architecture plan |
| `scaffold-microservice` | `/scaffold-microservice <spec>` | Scaffold Spring Boot service + CDK under a product |
| `scaffold-webui` | `/scaffold-webui <spec>` | Scaffold Astro SSR web UI + CDK under a product |

### Example Workflow

```bash
# 1. A new initiative arrives: "add a reservation checkout flow to booking"
# 2. Check registry → fits the existing "booking" product
# 3. Decompose to identify what's needed
claude /decompose-usecase "checkout flow for the booking product: users select availability slots, confirm reservation, receive confirmation"

# 4. Scaffold the new service under the booking product
claude /scaffold-microservice "reservation-service under david-iaggbs/sandbox-swe-dparra--booking: manages confirmed reservations, expose REST CRUD, publish ReservationConfirmed event, consume SlotReserved from availability-service"

# 5. Scaffold the UI
claude /scaffold-webui "booking-portal-ui under david-iaggbs/sandbox-swe-dparra--booking: customer-facing checkout UI, pages for slot selection and reservation confirmation, proxying availability-service and reservation-service"
```

---

## Required Tools

| Tool | Install | Required by |
|------|---------|-------------|
| [Claude Code CLI](https://claude.ai/claude-code) | `npm install -g @anthropic-ai/claude-code` | All skills |
| GitHub CLI | `brew install gh` | Repo creation, PR management |
| AWS CLI v2 | `brew install awscli` | `scaffold-microservice`, `scaffold-webui` |
| AWS CDK CLI | `npm install -g aws-cdk` | `scaffold-microservice`, `scaffold-webui` |
| Docker Desktop | [docker.com](https://www.docker.com/products/docker-desktop/) | `scaffold-microservice` (Testcontainers) |
| Java 21 (Corretto) | `brew install --cask corretto21` | `scaffold-microservice` |
| Maven 3.9+ | `brew install maven` | `scaffold-microservice` |
| Node.js 20 | `brew install node@20` | `scaffold-webui` |

## Required Environment Variables

| Variable | Purpose | Where to set |
|----------|---------|-------------|
| `AWS_PROFILE` | AWS credentials profile (`sandbox-swe-dparra-admin`) | `~/.aws/config` |

## GitHub Workflows

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| `epic-evaluation.yml` | Issue labeled `epic` | Evaluates the epic, maps to initiative, creates component issues |
| `initiative-intake.yml` | GitHub Project created in org | Evaluates domain fit, identifies impacted products, opens intake issue |
| `claude.yml` | `@claude` mention in comments/PRs (non-epic issues) | General-purpose Claude assistant |
| `claude-code-review.yml` | Pull request opened/updated | Automated code review |

## GitHub Actions Secrets

| Secret | Purpose |
|--------|---------|
| `CLAUDE_CODE_OAUTH_TOKEN` | Authenticates the Claude Code action |
| `GH_TOKEN` | PAT with `repo` scope across the `david-iaggbs` org — used by Claude to create issues in component repos (`--infra`, `--design`, `--service`, `--ui`) |

> `GH_TOKEN` must be a Personal Access Token (classic) with `repo` scope, or a fine-grained PAT with Issues read/write on all `david-iaggbs` repositories. Set it under **Settings → Secrets and variables → Actions** in this repository.

## One-Time Setup

```bash
# Configure AWS CLI with the sandbox profile
aws configure --profile sandbox-swe-dparra-admin

# Authenticate GitHub CLI
gh auth login

# Verify Docker is running
docker info
```
